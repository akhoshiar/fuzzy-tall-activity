<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fuzzy Height Membership Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h1 { text-align: center; }
    canvas {
      display: block;
      margin: 0 auto;
      background: #ffffff;
      border: 1px solid #ccc;
    }
    #controls {
      margin-top: 10px;
      text-align: center;
    }
    label { font-weight: bold; margin-right: 4px; }
    input[type="number"] { width: 70px; margin-right: 12px; }
    button { padding: 6px 12px; margin-left: 6px; cursor: pointer; }
    #results { margin-top: 10px; text-align: center; font-size: 0.95em; }
    #error { margin-top: 6px; text-align: center; color: darkred; min-height: 1.2em; }
  </style>
</head>
<body>
  <h1>Fuzzy Height Membership Demo</h1>

  <canvas id="chart" width="900" height="350"></canvas>

  <div id="controls">
    <label>H<sub>short</sub> (cm):</label>
    <input id="Hshort" type="number" value="160" min="140" max="220">

    <label>H<sub>medium</sub> (cm):</label>
    <input id="Hmed" type="number" value="175" min="140" max="220">

    <label>H<sub>tall</sub> (cm):</label>
    <input id="Htail" type="number" value="190" min="140" max="220">

    <label>x (cm):</label>
    <input id="x0" type="number" value="176" min="140" max="220">

    <button id="updateBtn">Update + fuzzify</button>
  </div>

  <div id="error"></div>
  <div id="results"></div>

  <script>
    const canvas = document.getElementById("chart");
    const ctx = canvas.getContext("2d");
    const minH = 140, maxH = 220;
    const marginLeft = 60, marginRight = 40, marginTop = 40, marginBottom = 40;
    const axisY = canvas.height - marginBottom;
    const axisX = marginLeft;

    const HshortEl = document.getElementById("Hshort");
    const HmedEl   = document.getElementById("Hmed");
    const HtailEl  = document.getElementById("Htail");
    const x0El     = document.getElementById("x0");
    const updateBtn = document.getElementById("updateBtn");
    const errorDiv  = document.getElementById("error");
    const resultsDiv = document.getElementById("results");

    function hToX(h) {
      return axisX + (h - minH) / (maxH - minH) * (canvas.width - marginLeft - marginRight);
    }

    function drawAxes() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // axes
      ctx.strokeStyle = "#333";
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(axisX, axisY);
      ctx.lineTo(canvas.width - marginRight, axisY);
      ctx.moveTo(axisX, axisY);
      ctx.lineTo(axisX, marginTop);
      ctx.stroke();

      // ticks
      ctx.font = "12px Arial";
      ctx.fillStyle = "#000";
      for (let h = minH; h <= maxH; h += 10) {
        const x = hToX(h);
        ctx.beginPath();
        ctx.moveTo(x, axisY);
        ctx.lineTo(x, axisY - 5);
        ctx.stroke();
        ctx.fillText(String(h), x - 10, axisY + 15);
      }
      ctx.fillText("Height (cm)", canvas.width/2 - 40, axisY + 30);

      // y labels
      ctx.textAlign = "right";
      ctx.fillText("0", axisX - 10, axisY + 4);
      ctx.fillText("1", axisX - 10, marginTop + 4);
      ctx.textAlign = "left";

      ctx.font = "18px Arial";
      ctx.textAlign = "center";
      ctx.fillText("Short / Medium / Tall Memberships", canvas.width/2, marginTop - 10);
      ctx.textAlign = "left";
    }

    // membership functions
    function muShort(x, Hs, Hm) {
      if (x <= Hs) return 1;
      if (x >= Hm) return 0;
      return (Hm - x) / (Hm - Hs);
    }
    function muMedium(x, Hs, Hm, Ht) {
      if (x <= Hs || x >= Ht) return 0;
      if (x === Hm) return 1;
      if (x < Hm) return (x - Hs) / (Hm - Hs);
      return (Ht - x) / (Ht - Hm);
    }
    function muTall(x, Hm, Ht) {
      if (x <= Hm) return 0;
      if (x >= Ht) return 1;
      return (x - Hm) / (Ht - Hm);
    }

    function update() {
      errorDiv.textContent = "";
      resultsDiv.textContent = "";

      const Hs = parseFloat(HshortEl.value);
      const Hm = parseFloat(HmedEl.value);
      const Ht = parseFloat(HtailEl.value);
      const x0 = parseFloat(x0El.value);

      if ([Hs,Hm,Ht,x0].some(v => isNaN(v))) {
        errorDiv.textContent = "Please enter all four values.";
        drawAxes();
        return;
      }
      if (!(Hs < Hm && Hm < Ht)) {
        errorDiv.textContent = "You must have H_short < H_medium < H_tall.";
        drawAxes();
        return;
      }
      if (x0 < minH || x0 > maxH) {
        errorDiv.textContent = `x must be between ${minH} and ${maxH} cm.`;
        drawAxes();
        return;
      }

      // compute membership curves
      const n = 400;
      const xs = [];
      const muS = [], muM = [], muT = [];
      for (let i = 0; i < n; i++) {
        const x = minH + i*(maxH-minH)/(n-1);
        xs.push(x);
        muS.push(muShort(x,Hs,Hm));
        muM.push(muMedium(x,Hs,Hm,Ht));
        muT.push(muTall(x,Hm,Ht));
      }

      drawAxes();

      // draw curves
      function drawCurve(values, color) {
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let i = 0; i < n; i++) {
          const xPix = hToX(xs[i]);
          const yPix = axisY - values[i]*(axisY - marginTop);
          if (i === 0) ctx.moveTo(xPix, yPix); else ctx.lineTo(xPix, yPix);
        }
        ctx.stroke();
      }

      drawCurve(muS, "#008000"); // green
      drawCurve(muM, "#e24a33"); // red
      drawCurve(muT, "#d8b11a"); // yellow

      // fuzzify x0
      const muS0 = muShort(x0,Hs,Hm);
      const muM0 = muMedium(x0,Hs,Hm,Ht);
      const muT0 = muTall(x0,Hm,Ht);

      // vertical line at x0
      const xPix0 = hToX(x0);
      ctx.setLineDash([6,4]);
      ctx.strokeStyle = "#000";
      ctx.beginPath();
      ctx.moveTo(xPix0, axisY);
      ctx.lineTo(xPix0, marginTop);
      ctx.stroke();
      ctx.setLineDash([]);

      // markers
      function drawMarker(mu, color) {
        const yPix = axisY - mu*(axisY - marginTop);
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(xPix0, yPix, 4, 0, 2*Math.PI);
        ctx.fill();
      }
      drawMarker(muS0, "#008000");
      drawMarker(muM0, "#e24a33");
      drawMarker(muT0, "#d8b11a");

      resultsDiv.innerHTML =
        `Short: μ = ${muS0.toFixed(3)} (${(muS0*100).toFixed(1)}%) &nbsp; | ` +
        `Medium: μ = ${muM0.toFixed(3)} (${(muM0*100).toFixed(1)}%) &nbsp; | ` +
        `Tall: μ = ${muT0.toFixed(3)} (${(muT0*100).toFixed(1)}%)`;
    }

    updateBtn.addEventListener("click", update);

    // initial draw
    drawAxes();
    update();
  </script>
</body>
</html>
